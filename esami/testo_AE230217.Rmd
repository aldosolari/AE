---
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Cognome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$ Nome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$ Matricola: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots$ 


## Prova scritta di ASM - Modulo Analisi Esplorativa del 23.02.2017

*La durata della prova è di 60 minuti*.\
*Si svolgano gli esercizi 1 e 2 riportando il risultato dove indicato.*


### Esercizio 1 (Punti: 7)

*Decomposizione Spettrale e Analisi delle Componenti Principali*


Data la matrice di varianze/covarianze $\underset{3\times 3}{S} = 
\left[
\begin{array}{ccc}
4 & 3 & 1 \\
3 & 9 & 2 \\
1 & 2 & 1 \\
\end{array}\right]$

a. Riportare

    - varianza totale = $\ldots\ldots\ldots\ldots$ e generalizzata  = $\ldots\ldots\ldots\ldots$ 
    
    - l'indice di variabilità relativo (\underline{arrotondare al secondo decimale})  = $\ldots\ldots\ldots\ldots$. 
    
b. Determinare la matrice di correlazione $\underset{3\times 3}{R} = 
\left[
\begin{array}{ccc}
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\end{array}\right].$


c. Determinare, \underline{arrotondando al secondo decimale}, $\underset{p\times p}{S^{1/2}} = 
\left[
\begin{array}{cc}
\\
\ldots\ldots &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots \\
\end{array}\right]$

d. Calcolare la correlazione tra la seconda colonna $\underset{n\times 1}{\tilde{x}_2}$ di $\underset{n\times p}{\tilde{X}}$ e i punteggi $\underset{n\times 1}{y_2}$ della seconda componente principale, \underline{arrotondando al secondo decimale}. 
$$= \ldots\ldots\ldots$$

```{r, echo=F, include=T}
rm(list=ls())
S = matrix(c(4,3,1,3,9,2,1,2,1), ncol=3)
# 1.a
sum(diag(S))
det(S)
round( det(S) / prod( diag(S) ), 2)
# 2.b
R = diag(diag(S)^(-1/2)) %*% S  %*% diag(diag(S)^(-1/2))
R
# 1.c 
V = eigen(S)$vectors
Lambda = diag(eigen(S)$values)
sqrtS = V %*% Lambda^(1/2) %*% t(V)
round(sqrtS,2)
# 1.d 
round( V[2,2]*sqrt(Lambda[2,2])/sqrt(S[2,2]) , 2)
```

*Distanze e Cluster Analysis*


e. Per una generica matrice di dati $\underset{n\times p}{X}$, si riporti la definizione di distanza di Lagrange $d_{\infty}(u_i,u_l)$ tra due unità statistiche $\underset{1\times p}{u'_i}$ e $\underset{1\times p}{u'_l}$. 

\fbox{\parbox[b][6em][t]{1\textwidth}{

\bigskip

\bigskip
$d_{\infty}(u_i,u_l) = $
\bigskip

}}


f. Per una generica matrice di distanze $\underset{n\times n}{D}$ con elemento di posizione $(i,l)$ pari a $d(u_i, u_l)$, si riporti la definizione di legame medio tra due gruppi $G_1$ e $G_2$. 

\fbox{\parbox[b][6em][t]{1\textwidth}{

\bigskip

\bigskip
$d(G_1,G_2) = $
\bigskip

}}


\newpage

## Esercizio 2 (Punti: 6.5)


Si consideri il dataset `crabs` presente nella libreria `MASS` (per caricare la libreria si usi il comando `library(MASS)`), che contiene $n=200$ unità statistiche (granchi Leptograpsus) relative alle seguenti $8$ variabili:

* *sp* (specie: `B` = blu o `O` = arancione)
* *sex* (sesso: `F` = femmina o `M` = maschio)
* *index* (indice)
* *FL* (misura del lobo frontale in mm) 
* *RW* (larghezza della parte posteriore in mm)
* *CL* (lunghezza del carapace in mm)
* *CW* (larghezza del carapace in mm)
* *BD* (profondità del corpo in mm)


a. Si consideri la matrice $\underset{200\times 5}{X}$ che contiene le seguenti variabili: *FL*, *RW*, *CL*, *CW* e *BD*. Per ciascuna unità statistica $u'_i$, si calcoli la distanza di Mahalanobis dal baricentro $\bar{x}'$ e si riporti il numero di unità statistiche con distanza di Mahalanobis superiore a $3.33$:


$$\sum_{i=1}^{n} I\{ d_M(u_i,\bar{x}) > 3.33\} = \ldots$$

```{r, echo=F, include=T}
rm(list=ls())
library(MASS)
X = as.matrix(crabs[,4:8])
n = nrow(X)
# vettore medie
xbar = matrix(colMeans(X), ncol=1)
S = var(X)*((n-1)/n)
# matrice inversa
InvS = solve(S)
# quadrato della distanza di Mahalanobis per le n osservazioni
dM2 = apply(X,1, function(u) t(u-xbar) %*% InvS %*% (u - xbar) )

sum(sqrt(dM2) > 3.33)
```




b. Calcolare la matrice dei dati standardizzati $\underset{200\times 5}{Z}$. Sulla base di $\underset{200\times 5}{Z}$, calcolare la matrice delle distanze $\underset{200\times 200}{D}$ utilizzando la metrica di Lagrange, ed effettuare l'analisi dei cluster gerarchica utilizzando il legame completo, ricavandone 3 gruppi. 
Riportare i valori della tabella a doppia entrata che incrocia la classificazione ottenuta e la variabile `sp`. 

```{r, echo=F, include=T}
Z = scale(X, center=T, scale = diag(S)^(1/2))
D = dist(Z, method="maximum")
hc = hclust(D, method="complete")
gruppi = cutree(hc, k=3)
table( gruppi, crabs$sp )
```

\fbox{\parbox[b][11em][t]{1\textwidth}{ 
\begin{tabular}{c|c|c|}
 & \multicolumn{2}{c}{Specie}\\
        & B $\quad$ & O $\quad$ \\
\hline
Gruppo 1 & & \\
& & \\
Gruppo 2 & & \\
& & \\
Gruppo 3 & & \\
& & \\
 \hline
\end{tabular}
}}

c. Calcolare, arrotondando al secondo decimale, il valore medio della silhouette per i tre gruppi individuati al punto b. (utilizzando il comando `silhouette` presente nella libreria `cluster`). 

```{r, echo=F, include=T}
# valore medio della silhouette
require(cluster)
sil = silhouette(gruppi, dist=D)
round( summary(sil)$ clus.avg.widths, 2)
```


\fbox{\parbox[b][12em][t]{1\textwidth}{ 

\bigskip

\begin{tabular}{c|c}
 & Valore medio della Silhouette\\
\hline
Gruppo 1 &  \\
&  \\
Gruppo 2 &  \\
&  \\
Gruppo 3 &  \\
&  \\
 \hline
\end{tabular}
}}


