---
output:
  pdf_document: default
  html_document: default
---

**25 Gennaio 2018 - Analisi Esplorativa**

Cognome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Nome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Matricola: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Tipologia d'esame: $\qquad \Box$ 12 CFU $\qquad$ $\Box$ 15 CFU 

\bigskip

\hrule

**Prova scritta**

*Si svolgano gli esercizi riportando il risultato dove indicato. Durata: 80 minuti*

\bigskip

\hrule

\bigskip

### Esercizio 1 (7 punti)

Si consideri la seguente matrice di correlazione $\underset{3\times 3}{R} = 
\left[
\begin{array}{ccc}
1 & 1/2 & 1/2 \\
1/2 & 1 & 2/3 \\
1/2 & 2/3 & 1 \\
\end{array}\right]$. 

a. Riportare l'indice di variabilità relativo, arrotondando al secondo decimale: $\ldots\ldots\ldots$

b. Sia $\underset{n\times 3}{\tilde{X}}$ la matrice dei dati centrati. Determinare l'angolo (espresso in gradi) tra $\underset{n\times 1}{\tilde{x}_1}$ e $\underset{n\times 1}{\tilde{x}_3}$: $=\ldots\ldots\ldots\ldots$

c. Sapendo che $s_{11}=4$, $s_{22}=9$ e $\mathrm{tr}(S)=14$, calcolare $\mathrm{det}(S) = \ldots\ldots\ldots$, dove $\underset{3\times 3}{S}$ rappresenta la matrice di varianze/covarianze.

d. Calcolare
$S = 
\left[
\begin{array}{ccc}
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\end{array}\right]$ 

e. Determinare gli autovalori di $S$, arrotondando al secondo decimale: $\lambda_1=\ldots\ldots$, $\lambda_2=\ldots\ldots$, $\lambda_3=\ldots\ldots$ 

f. Calcolare, arrotondando al secondo decimale, $S^{1/2} = 
\left[
\begin{array}{ccc}
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\end{array}\right]$.

g. Calcolare la correlazione tra la terza colonna $\underset{n\times 1}{\tilde{x}_3}$ di $\underset{n\times 3}{\tilde{X}}$ e i punteggi $\underset{n\times 1}{y_2}$ della seconda componente principale (calcolata a partire da $S$), arrotondando al secondo decimale: $= \ldots\ldots\ldots$

h. Si consideri la seguente trasformazione lineare: $\underset{n\times 3}{W} =  \underset{n\times 3}{X}\underset{3\times 3}{A'}$, dove $A = \mathrm{diag}(1,2,3)$. 
Calcolare la matrice di varianze/covarianze di $W$, 
$S^W = 
\left[
\begin{array}{ccc}
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\\
\ldots\ldots &  \ldots\ldots  &  \ldots\ldots\\
\end{array}\right]$

```{r, echo=FALSE, eval =T}
R = matrix(c(1,1/2,1/2,1/2,1,2/3,1/2,2/3,1), byrow=T, ncol=3)
# a
round(det(R),2)
# b
acos(R[1,3])*(180/pi)
# c
s11=4
s22=9
s33=14-s11-s22
det(R)*(s11*s22*s33)
# d
D = diag(c(s11,s22,s33))
S = D^(1/2) %*% R %*% D^(1/2)
S
# e 
lambdas = eigen(S)$values
round(lambdas,2)
# f
V = eigen(S)$vectors
sqrtS = V %*% diag( lambdas^(1/2) ) %*% t(V)
round(sqrtS,2)
# g
round( V[3,2]*sqrt(lambdas[2])/sqrt(s33) , 2)
# h
A = diag(1:3)
S_W = A %*% S %*% t(A)
S_W
```

\newpage

### Esercizio 2 (2 punti)

Riportare le seguenti definizioni (in forma matriciale), specificando tutte le quantità coinvolte:

\vspace{0.5cm}

a. Vettore delle medie

\vspace{0.5cm}

b. Matrice di centramento

\vspace{0.5cm}

c. Matrice dei dati centrati 

\vspace{0.5cm}

d. Matrice di varianze/covarianze

\vspace{0.5cm}

e. Matrice dei dati standardizzati 

\vspace{0.5cm}

f. Matrice dei dati ortogonalizzati 



### Esercizio 3 (4 punti)

Dimostrare, esplicitando tutti i passaggi, e specificando tutte le quantità coinvolte,

a. che la matrice di varianze/covarianze $S$ è semi-definita positiva, esplicitando tutti i passaggi.

\vspace{4cm}

b. che $\mathrm{tr}(S) = \sum_{j=1}^{p}\lambda_j$, dove $\lambda_1,\ldots,\lambda_p$ sono gli autovalori di $S$.

\vspace{4cm}

d. Enunciare il Teorema di Eckart-Young. 

\newpage

### Esercizio 4 (2 punti)

Un gruppo di $n=112$ individui si è sottoposto a $p=6$ prove di abilità e intelligenza. 
Caricare la matrice di varianza/covarianza `ability.cov` presente nella libreria `dataset` e si risponda alle seguenti domande:

a. Sulla base dalla matrice di correlazione $R$, si stimi il modello fattoriale con $k=2$ fattori utilizzando il metodo della massima verosimiglianza ed effettuando la rotazione varimax. 
Arrontondando al secondo decimale, si riportino le stime delle comunalità $$\hat{h}^2_1= \ldots\ldots\ldots, \hat{h}^2_2= \ldots\ldots\ldots, \hat{h}^2_3= \ldots\ldots\ldots, \hat{h}^2_4= \ldots\ldots\ldots, \hat{h}^2_5= \ldots\ldots\ldots, \hat{h}^2_6= \ldots\ldots\ldots$$


```{r, echo=FALSE, eval =T}
# a
rm(list=ls())
n = 112
S = ability.cov$cov
D = diag(diag(S)^(-1/2))
R = D %*% S %*%D
af <- factanal(covmat=R, factors=2, n.obs = n, rotation = "varimax")
round(apply(af$loadings[,]^2,1,sum),2)
```

### Esercizio 5 (2 punti)

a. Siano date due unità statistiche $u_1' = (2, 3)$ e $u_2' = (1, 1)$. Riportare la distanza Euclidea $d_2(u_1,u_2) = \ldots\ldots\ldots$, di Manhattan $d_1(u_1,u_2) = \ldots\ldots\ldots$, di Lagrange $d_\infty(u_1,u_2) = \ldots\ldots\ldots$

b. Si consideri la seguente matrice di distanze relativa a tre unità statistiche $u_1$, $u_2$ e $u_3$: 

\begin{tabular}{c|ccc}
 $d(u_i,u_l)$ & $u_1$ & $u_2$ & $u_3$  \\
 \hline
$u_1$   & 0 \\
$u_2$   & 3 & 0 \\
$u_3$   & 5 & 4 & 0 \\
\end{tabular}

Completare la tabella sottostante calcolando la decomposizione della distanza totale $T= \frac{1}{2} \sum_{i=1}^{3}\sum_{l=1}^{3} d(u_i,u_l)$ in distanza entro i gruppi $W$ e tra i gruppi $B$ per le tre unità statistiche $u_1$, $u_2$ e $u_3$ raggruppate in due gruppi $G_1$ e $G_2$:

\begin{tabular}{| l | rrr |}
\hline
 $G_1,G_2$ &  $W$  & $B$ & $T$ \\
 \hline
($u_1$), ($u_2,u_3$) & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$\\  
($u_1,u_2$), ($u_3$)  & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$\\
($u_1,u_3$), ($u_2$) & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$\\
\hline
\end{tabular}


### Esercizio 6 (2 punti)

Riportare la statistica test con la correzione di Bartlett:

$T_{Bartlett}=$

\newpage

### Esercizio 7 (3 punti)

a. Si riporti il modello fattoriale con $k$ fattori in forma matriciale, specificando tutte le assunzioni. 

\vspace{5cm}

b. Si dimostri che $S^Z = R^X$, ovvero che la matrice di varianze/covarianze calcolata per $Z$ risulta uguale alla matrice di correlazione calcolata per $X$.

\vspace{2.5cm}

### Esercizio 8 (4 punti)

Si consideri il dataset `swiss` presente nella libreria `datasets`, che contiene $n=47$ unità statistiche (provincie) relative alle seguenti $6$ variabili:

* *Fertility* : common standardized fertility measure
* *Agriculture* : \% of males involved in agriculture as occupation
* *Examination* : \% draftees receiving highest mark on army examination
* *Education* : \% education beyond primary school for draftees
* *Catholic* : % catholic (as opposed to protestant)
* *Infant.Mortality* : live births who live less than 1 year

a. Per ciascuna unità statistica, si calcoli la distanza di Mahalanobis dal baricentro e si riporti il nome delle provincie con distanza superiore a $3.6$:

```{r, echo=FALSE, eval =T}
# a
rm(list=ls())
X = as.matrix(swiss)
n = nrow(X)
xbar = matrix(colMeans(X), ncol=1)
S = var(X)*((n-1)/n)
InvS = solve(S)
dM2 = apply(X,1, function(u) t(u-xbar) %*% InvS %*% (u - xbar) )
which(sqrt(dM2) > 3.6)
```

\bigskip
\bigskip

b. Dopo aver standardizzato i dati, eseguire l'algoritmo delle $K$-medie (`algorithm = Hartigan-Wong`) per $K=2,4,6$, inizializzando i centroidi con le osservazioni di riga $1,2,\ldots,K$. Riportare per ciascun valore di $K$ il rispettivo valore dell’indice Calinski and Harabasz, arrotondando al secondo decimale. 

```{r, echo=FALSE, eval =T}
# b
Z = scale(X, center=T, scale= diag(S)^(1/2))
K = c(2,4,6)
CH <- vector()
for (i in 1:length(K)){
  k = K[i]
  km = kmeans(Z, centers = Z[1:k,])
  W = km$tot.withinss
  B = km$betweenss 
  CH[i] = (B/(k-1)) / (W/(n-k))
}
rbind(K, round(CH,2))
```

\begin{tabular}{c|ccc}
 $K$ & 2 & 4 & 6  \\
\hline
\\
 Indice CH & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$ & $\ldots\ldots\ldots$  \\
\end{tabular}

c. Sulla base della matrice dei dati standardizzati, calcolare la matrice delle distanze utilizzando la metrica Euclidea. 
Riportare, arrotondando al secondo decimale, il valore medio della silhouette per i $K=4$ gruppi determinati nel punto precedente. 

\begin{tabular}{c|cccc}
 gruppo & 1 & 2 & 3 & 4  \\
 \hline
 \\
 silhouette (media) & $\ldots\ldots$ & $\ldots\ldots$ & $\ldots\ldots$ &  $\ldots\ldots$ \\
\end{tabular}

```{r, echo=FALSE, eval =T}
# c
require(cluster)
D = dist(Z)
gruppi = kmeans(Z, centers = Z[1:4,])$cluster
sil = silhouette(gruppi, dist=D)
round( summary(sil)$ clus.avg.widths, 2)
```