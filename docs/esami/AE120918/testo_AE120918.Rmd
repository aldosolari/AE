---
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
echo = F, 
include = T,
message = F, 
warning = F)
```


**12 Settembre 2018 - Analisi Esplorativa**

Cognome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Nome: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Matricola: $\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots\ldots$

Tipologia d'esame: $\qquad \Box$ 12 CFU $\qquad$ $\Box$ 15 CFU 

\bigskip

\hrule

**Prova scritta - fila A**

*Si svolgano gli esercizi riportando il risultato dove indicato. Durata: 60 minuti*

\bigskip

\hrule


### Esercizio 1 (9 punti)

Alla matrice di varianze/covarianze relativa a $\underset{n\times p}{X}$ sono associati i seguenti autovalori e autovettori normalizzati:
$\lambda_1 = 9$, $\lambda_2 =6$, $\underset{2\times 1}{v_1} = \left[
\begin{array}{c}
1/\sqrt{5}\\
2/\sqrt{5}\\
\end{array}
\right]$ e $\underset{2\times 1}{v_2} = \left[
\begin{array}{c}
2/\sqrt{5}\\
-1/\sqrt{5}\\
\end{array}
\right]$. 

a. Quante sono le colonne di $\underset{n\times p}{X}?$  $p = \ldots\ldots$

b. Determinare la matrice di varianze/covarianze $\underset{p\times p}{S} = 
\left[
\begin{array}{cc}
\\
\ldots\ldots &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots \\
\end{array}\right]$


c. Riportare

    - varianza totale = $\ldots\ldots\ldots\ldots$ e generalizzata  = $\ldots\ldots\ldots\ldots$ 
    
    - l'indice di variabilità relativo (\underline{arrotondare al secondo decimale})  = $\ldots\ldots\ldots\ldots$. 

d. Determinare, **arrotondando al secondo decimale**, $\underset{p\times p}{S^{1/2}} = 
\left[
\begin{array}{cc}
\\
\ldots\ldots &  \ldots\ldots \\
\\
\ldots\ldots &  \ldots\ldots \\
\end{array}\right]$

e. Calcolare la correlazione tra la seconda colonna $\underset{n\times 1}{\tilde{x}_2}$ di $\underset{n\times p}{\tilde{X}}$ e i punteggi $\underset{n\times 1}{y_2}$ della seconda componente principale, **arrotondando al secondo decimale**. 
$$= \ldots\ldots\ldots$$

g. Dimostrare, esplicitando tutti i passaggi, e specificando tutte le quantità coinvolte, che una generica matrice di varianze/covarianze $S$ è semi-definita positiva, esplicitando tutti i passaggi.



\vspace{2cm}



```{r}
rm(list=ls())
# 1.b
Lambda = diag(c(9,6))
V = matrix(c(1/sqrt(5),2/sqrt(5),2/sqrt(5),-1/sqrt(5)), byrow=F, ncol=2)
S = V %*% Lambda %*% t(V)
S
# 1.c
prod(diag(Lambda))
sum(diag(Lambda))
round( det(S) / prod( diag(S) ), 2)
# 1.d 
sqrtS = V %*% Lambda^(1/2) %*% t(V)
round(sqrtS,2)
# 1.e 
round( V[2,2]*sqrt(Lambda[2,2])/sqrt(S[2,2]) , 2)
```


\newpage

### Esercizio 2 (9 punti)

Si consideri la seguente matrice di distanza:

\begin{table}[ht]
\centering
\begin{tabular}{r|rrrrrr|}
  \hline
 & $u_1$ & $u_2$ & $u_3$ & $u_4$ & $u_5$ & $u_6$ \\ 
  \hline
$u_1$ & 0 & 4 & 6 & 12 & 13 & 7 \\ 
$u_2$ & 4 & 0 & 2 & 8 & 9 & 5 \\ 
$u_3$ & 6 & 2 & 0 & 6 & 7 & 5 \\ 
$u_4$ & 12 & 8 & 6 & 0 & 1 & 9 \\ 
$u_5$ & 13 & 9 & 7 & 1 & 0 & 8 \\ 
$u_6$ & 7 & 5 & 5 & 9 & 8 & 0 \\ 
   \hline
\end{tabular}
\end{table}

a. Si rappresenti con il dendrogramma la sequenza di partizioni ottenuta con l'algoritmo gerarchico agglomerativo basato sul legame singolo, riportando sull'asse delle ordinate le distanze corrispondenti. 

\vspace{5cm}

b. Si riporti il valore medio della *silhouette* (**arrotondando al secondo decimale**) per i raggruppamenti in $K = 2,3,4$ e $5$ gruppi. Si identifichi il numero di gruppi ottimale secondo questo criterio. 

\begin{table}[ht]
\centering
\begin{tabular}{cc}
  \hline
N.ro di gruppi $K$ &  Valore medio della silhouette \\ 
  \hline
 2 &  $\ldots$\\
 3 &  $\ldots$\\
 4 &  $\ldots$\\
 5 &  $\ldots$\\
   \hline
   \\
N.ro di gruppi ottimale? &  $K^{*} = \ldots\ldots$ \\
\end{tabular}
\end{table}




```{r}
rm(list=ls())
D = as.dist(matrix(c(0, 4, 6, 12, 13, 7,
4, 0, 2, 8, 9, 5,
6, 2, 0, 6, 7, 5,
12, 8, 6, 0, 1, 9,
13, 9, 7, 1, 0, 8,
7, 5, 5, 9, 8, 0), ncol=6))
hc = hclust(d=D, method = "single")
# 2.a
plot(hc)
# 2.b
k2=cutree(hc, k=2)
k3=cutree(hc, k=3)
k4=cutree(hc, k=4)
k5=cutree(hc, k=5)
require(cluster)
round(summary(silhouette(k2, dist=D))$avg.width,2)
round(summary(silhouette(k3, dist=D))$avg.width,2)
round(summary(silhouette(k4, dist=D))$avg.width,2)
round(summary(silhouette(k5, dist=D))$avg.width,2)
```



Si consideri la seguente matrice di distanza:

\begin{tabular}{c|ccccc}
 & $u_1$ & $u_2$ & $u_3$ & $u_4$ & $u_5$ \\
 \hline
$u_1$ & 0 \\
$u_2$ & 9 & 0 \\
$u_3$ & 3 & 7 & 0 \\
$u_4$ & 6 & 5 & 9 & 0 \\
$u_5$ & 11 & 10 & 2 & 8 & 0\\
\end{tabular}

c. Se utilizziamo un algoritmo gerarchico agglomerativo, le unità $u_3$ e $u_5$ vengono messe assieme nel gruppo
$(u_3, u_5)$. Aggiornare la matrice delle distanze utilizzando i metodi del legame singolo e completo:

\begin{center}
\begin{tabular}{c|ccccc}
Singolo &  $(u_3,u_5)$ & $u_1$ & $u_2$ & $u_4$  \\
 \hline
$(u_3,u_5)$ & 0 \\
$u_1$     & $\ldots\ldots$ & 0 \\
$u_2$     & $\ldots\ldots$ & $\ldots\ldots$ & 0 \\
$u_4$     & $\ldots\ldots$ & $\ldots\ldots$ & $\ldots\ldots$  & 0 \\
\end{tabular}
\begin{tabular}{c|ccccc}
Completo &  $(u_3,u_5)$ & $u_1$ & $u_2$ & $u_4$  \\
 \hline
$(u_3,u_5)$ & 0 \\
$u_1$     & $\ldots\ldots$ & 0 \\
$u_2$     & $\ldots\ldots$ & $\ldots\ldots$ & 0 \\
$u_4$     & $\ldots\ldots$ & $\ldots\ldots$ & $\ldots\ldots$  & 0 \\
\end{tabular}
\end{center}


### Esercizio 3 (8 punti)


Un gruppo di $n=112$ individui si è sottoposto a $p=6$ prove di abilità e intelligenza. 
Caricare la matrice di **varianze/covarianze** $S$ `ability.cov` presente nella libreria `datasets`. Sulla base dalla matrice di **correlazione** $R$, si stimi il modello fattoriale con $k=2$ fattori utilizzando il metodo della massima verosimiglianza senza effettuare nessuna rotazione. 

a. Si riporti la stima dei pesi fattoriali (arrotondando al **primo decimale**):

$$ \underset{p\times k}{\hat{\Lambda}} = 
\left[ \begin{array}{cc}
        \ldots\ldots  & \ldots\ldots \\
       \ldots\ldots   &  \ldots\ldots \\
        \ldots\ldots   &  \ldots\ldots \\
        \ldots\ldots   &  \ldots\ldots \\
          \ldots\ldots   &  \ldots\ldots \\
             \ldots\ldots   &  \ldots\ldots \\
         \end{array} 
\right]$$

b. Calcolare, arrotondando al **quarto decimale**, il valore della statistiche test
$$T= n \log \Big( \frac{\mathrm{det}(\hat{\Lambda} \hat{\Lambda}' + \hat{\Psi})}{\mathrm{det}(R)} \Big)= \ldots $$


c. Si descriva il modello fattoriale con $k$ fattori in forma matriciale, specificando tutte le assunzioni

\vspace{8cm}


d. Data una generica matrice $\underset{n\times p}{X}$ con vettore delle medie $\underset{p\times 1}{\bar{x}}$ e matrice di varianze/covarianze $\underset{p\times p}{S}$, si riporti la definizione della distanza di Mahalanobis $d_{M}(u_i,\bar{x})$ tra l'$i$-sima unità statistica
 $\underset{1\times p}{u'_i}$ e il baricentro $\underset{1\times p}{\bar{x}'}$.


\bigskip
$d_{M}(u_i,\bar{x}) =$
\bigskip



```{r}
rm(list=ls())
# 3.a
n = 112
S = ability.cov$cov
D = diag(diag(S)^(-1/2))
R = D %*% S %*%D
af <- factanal(covmat=R, factors=2, n.obs = n, rotation = "none")
Lambda = af$loadings[,]
round(Lambda,1)
# 3.b
Psi = diag(af$uniquenesses)
Tstat = n*log(det(Lambda %*% t(Lambda) + Psi )/det(R))
round(Tstat,4)
```
